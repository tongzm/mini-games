<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ğŸ¦ ä¹Œé¸¦å–æ°´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            background: linear-gradient(180deg, #87CEEB 0%, #98D8C8 50%, #7CB342 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            overflow: hidden;
        }

        h1 {
            color: #2E7D32;
            font-size: 36px;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.5);
            margin-bottom: 10px;
        }

        .game-info {
            display: flex;
            gap: 30px;
            margin-bottom: 15px;
            font-size: 22px;
            color: #1B5E20;
        }

        .info-box {
            background: rgba(255,255,255,0.8);
            padding: 8px 20px;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .game-scene {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 450px;
            display: flex;
            justify-content: center;
            align-items: flex-end;
        }

        /* ä¹Œé¸¦ */
        .crow {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 80px;
            z-index: 10;
            transition: all 0.5s ease;
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.3));
        }

        .crow.drinking {
            top: 80px;
            animation: drinkAnim 0.5s ease-in-out infinite;
        }

        @keyframes drinkAnim {
            0%, 100% { transform: translateX(-50%) rotate(0deg); }
            50% { transform: translateX(-50%) rotate(10deg); }
        }

        /* æ°´ç“¶ */
        .bottle {
            position: relative;
            width: 120px;
            height: 280px;
            background: linear-gradient(90deg, 
                rgba(200,230,255,0.3) 0%, 
                rgba(255,255,255,0.5) 30%,
                rgba(200,230,255,0.3) 100%);
            border: 4px solid rgba(100,150,200,0.6);
            border-radius: 20px 20px 40px 40px;
            overflow: hidden;
            box-shadow: inset 0 0 30px rgba(255,255,255,0.5), 0 10px 30px rgba(0,0,0,0.2);
        }

        /* ç“¶å£ */
        .bottle::before {
            content: '';
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 30px;
            background: linear-gradient(90deg, 
                rgba(200,230,255,0.4) 0%, 
                rgba(255,255,255,0.6) 50%,
                rgba(200,230,255,0.4) 100%);
            border: 4px solid rgba(100,150,200,0.6);
            border-bottom: none;
            border-radius: 10px 10px 0 0;
        }

        /* æ°´ */
        .water {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20%;
            background: linear-gradient(180deg, #4FC3F7 0%, #0288D1 100%);
            transition: height 0.5s ease;
            border-radius: 0 0 36px 36px;
        }

        .water::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 15px;
            background: linear-gradient(180deg, rgba(255,255,255,0.4) 0%, transparent 100%);
            animation: wave 2s ease-in-out infinite;
        }

        @keyframes wave {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        /* çŸ³å­åŒºåŸŸ */
        .stones-area {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            max-width: 380px;
        }

        .stone {
            width: 60px;
            height: 60px;
            background: linear-gradient(145deg, #9E9E9E, #616161);
            border-radius: 50% 40% 50% 40%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 3px 3px 8px rgba(0,0,0,0.3), inset -2px -2px 5px rgba(0,0,0,0.2);
            transition: all 0.15s;
            animation: stoneBounce 2s ease-in-out infinite;
        }

        .stone:nth-child(odd) {
            animation-delay: 0.5s;
        }

        @keyframes stoneBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .stone:hover {
            transform: scale(1.1);
            box-shadow: 4px 4px 12px rgba(0,0,0,0.4);
        }

        .stone:active {
            transform: scale(0.95);
        }

        .stone.used {
            opacity: 0.3;
            pointer-events: none;
            transform: scale(0.8);
        }

        /* è½å…¥åŠ¨ç”»çš„çŸ³å­ */
        .falling-stone {
            position: absolute;
            font-size: 40px;
            z-index: 20;
            pointer-events: none;
            animation: fallIntoBottle 0.8s ease-in forwards;
        }

        @keyframes fallIntoBottle {
            0% { 
                opacity: 1;
                transform: translateY(0) rotate(0deg); 
            }
            70% { 
                opacity: 1;
                transform: translateY(200px) rotate(180deg); 
            }
            100% { 
                opacity: 0;
                transform: translateY(250px) rotate(360deg); 
            }
        }

        /* ç“¶ä¸­çŸ³å­ */
        .bottle-stones {
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            width: 90%;
            z-index: 5;
        }

        .bottle-stone {
            font-size: 22px;
            margin: 2px;
            animation: settleStone 0.3s ease-out;
        }

        @keyframes settleStone {
            0% { transform: translateY(-20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        /* æ¶ˆæ¯å¼¹çª— */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .modal-content {
            background: linear-gradient(145deg, #FFF8E1, #FFECB3);
            padding: 30px;
            border-radius: 25px;
            text-align: center;
            max-width: 90%;
            width: 350px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            animation: popIn 0.4s ease-out;
        }

        @keyframes popIn {
            0% { transform: scale(0); }
            70% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .modal h2 {
            color: #E65100;
            font-size: 32px;
            margin-bottom: 15px;
        }

        .modal p {
            color: #5D4037;
            font-size: 22px;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .modal .emoji-big {
            font-size: 80px;
            margin: 15px 0;
        }

        .btn {
            padding: 15px 40px;
            font-size: 24px;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(145deg, #4CAF50, #388E3C);
            color: white;
            box-shadow: 0 4px 15px rgba(76,175,80,0.4);
        }

        .btn-primary:active {
            transform: scale(0.95);
        }

        .hidden {
            display: none !important;
        }

        /* æˆåŠŸç‰¹æ•ˆ */
        .success-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
        }

        .confetti {
            position: absolute;
            font-size: 30px;
            animation: confettiFall 3s ease-out forwards;
        }

        @keyframes confettiFall {
            0% { 
                opacity: 1;
                transform: translateY(-20px) rotate(0deg); 
            }
            100% { 
                opacity: 0;
                transform: translateY(100vh) rotate(720deg); 
            }
        }

        .tip-text {
            background: rgba(255,255,255,0.9);
            padding: 10px 20px;
            border-radius: 15px;
            font-size: 20px;
            color: #1B5E20;
            margin-top: 15px;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- æ•™ç¨‹å¼¹çª— -->
    <div class="modal" id="tutorial">
        <div class="modal-content">
            <h2>ğŸ¦ ä¹Œé¸¦å–æ°´</h2>
            <div class="emoji-big">ğŸ¦ğŸ’§</div>
            <p>ä¹Œé¸¦å£æ¸´äº†ï¼Œä½†æ°´å¤ªå°‘å¤Ÿä¸ç€ï¼</p>
            <p>ğŸ‘‰ ç‚¹å‡»<b>çŸ³å­</b>æ‰”è¿›ç“¶å­</p>
            <p>ğŸ’§ æ°´ä½ä¸Šå‡ï¼Œä¹Œé¸¦å°±èƒ½å–åˆ°æ°´å•¦ï¼</p>
            <button class="btn btn-primary" onclick="startGame()">å¼€å§‹å¸®å¿™ï¼</button>
        </div>
    </div>

    <!-- æˆåŠŸå¼¹çª— -->
    <div class="modal hidden" id="successModal">
        <div class="modal-content">
            <h2>ğŸ‰ å¤ªæ£’äº†ï¼</h2>
            <div class="emoji-big">ğŸ¦ğŸ’¦</div>
            <p>ä¹Œé¸¦å–åˆ°æ°´å•¦ï¼</p>
            <p id="successMsg">æ‚¨ç”¨äº† <b><span id="stoneCount">0</span></b> é¢—çŸ³å­</p>
            <p style="color:#4CAF50;">é‡åˆ°å›°éš¾è¦åŠ¨è„‘ç­‹å“¦ï½</p>
            <button class="btn btn-primary" onclick="restartGame()">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <h1>ğŸ¦ ä¹Œé¸¦å–æ°´</h1>

    <div class="game-info">
        <div class="info-box">çŸ³å­ï¼š<span id="stonesLeft">8</span> é¢—</div>
        <div class="info-box">æ°´ä½ï¼š<span id="waterLevel">20</span>%</div>
    </div>

    <div class="game-scene" id="gameScene">
        <div class="crow" id="crow">ğŸ¦</div>
        <div class="bottle" id="bottle">
            <div class="water" id="water"></div>
            <div class="bottle-stones" id="bottleStones"></div>
        </div>
    </div>

    <div class="tip-text">ğŸ‘† ç‚¹å‡»ä¸‹é¢çš„çŸ³å­æ‰”è¿›ç“¶å­é‡Œ</div>

    <div class="stones-area" id="stonesArea">
        <!-- çŸ³å­ä¼šåœ¨è¿™é‡Œç”Ÿæˆ -->
    </div>

    <div class="success-effect" id="successEffect"></div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const TOTAL_STONES = 8;
        const WATER_PER_STONE = 10; // æ¯é¢—çŸ³å­æ°´ä½ä¸Šå‡10%
        const WIN_WATER_LEVEL = 90; // æ°´ä½è¾¾åˆ°90%å°±èµ¢äº†
        
        let stonesUsed = 0;
        let waterLevel = 20; // åˆå§‹æ°´ä½20%
        let gameWon = false;

        // éŸ³æ•ˆç³»ç»Ÿ
        let audioCtx = null;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        // çŸ³å­è½æ°´éŸ³æ•ˆ
        function playPlunkSound() {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine';
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(400, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + 0.3);
        }

        // æ°´ä½ä¸Šå‡éŸ³æ•ˆ
        function playWaterRiseSound() {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine';
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(300, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(500, audioCtx.currentTime + 0.4);
            gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            osc.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + 0.4);
        }

        // èƒœåˆ©éŸ³æ•ˆ
        function playVictorySound() {
            if (!audioCtx) return;
            [523, 659, 784, 1047].forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime + i * 0.15);
                gain.gain.setValueAtTime(0.25, audioCtx.currentTime + i * 0.15);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + i * 0.15 + 0.3);
                osc.start(audioCtx.currentTime + i * 0.15);
                osc.stop(audioCtx.currentTime + i * 0.15 + 0.3);
            });
        }

        // åˆå§‹åŒ–çŸ³å­
        function initStones() {
            const area = document.getElementById('stonesArea');
            area.innerHTML = '';
            for (let i = 0; i < TOTAL_STONES; i++) {
                const stone = document.createElement('div');
                stone.className = 'stone';
                stone.innerHTML = 'ğŸª¨';
                stone.onclick = () => throwStone(stone, i);
                area.appendChild(stone);
            }
        }

        // æ‰”çŸ³å­
        function throwStone(stoneEl, index) {
            if (gameWon || stoneEl.classList.contains('used')) return;

            initAudio();
            stoneEl.classList.add('used');
            stonesUsed++;

            // åˆ›å»ºè½ä¸‹çš„çŸ³å­åŠ¨ç”»
            const scene = document.getElementById('gameScene');
            const falling = document.createElement('div');
            falling.className = 'falling-stone';
            falling.innerHTML = 'ğŸª¨';
            falling.style.left = '50%';
            falling.style.top = '50px';
            falling.style.transform = 'translateX(-50%)';
            scene.appendChild(falling);

            // æ’­æ”¾è½æ°´éŸ³æ•ˆ
            setTimeout(() => {
                playPlunkSound();
            }, 500);

            // è½ä¸‹åæ·»åŠ åˆ°ç“¶å­é‡Œ
            setTimeout(() => {
                falling.remove();
                addStoneToBottle();
                raiseWater();
            }, 800);

            updateDisplay();
        }

        // æ·»åŠ çŸ³å­åˆ°ç“¶å­
        function addStoneToBottle() {
            const bottleStones = document.getElementById('bottleStones');
            const stone = document.createElement('span');
            stone.className = 'bottle-stone';
            stone.innerHTML = 'ğŸª¨';
            bottleStones.appendChild(stone);
        }

        // æ°´ä½ä¸Šå‡
        function raiseWater() {
            waterLevel += WATER_PER_STONE;
            if (waterLevel > 100) waterLevel = 100;

            const water = document.getElementById('water');
            water.style.height = waterLevel + '%';

            playWaterRiseSound();
            updateDisplay();

            // æ£€æŸ¥æ˜¯å¦èµ¢äº†
            if (waterLevel >= WIN_WATER_LEVEL) {
                setTimeout(winGame, 500);
            }
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            document.getElementById('stonesLeft').textContent = TOTAL_STONES - stonesUsed;
            document.getElementById('waterLevel').textContent = waterLevel;
        }

        // èµ¢äº†ï¼
        function winGame() {
            gameWon = true;
            playVictorySound();

            // ä¹Œé¸¦å–æ°´åŠ¨ç”»
            const crow = document.getElementById('crow');
            crow.classList.add('drinking');

            // æ’’èŠ±ç‰¹æ•ˆ
            showConfetti();

            // æ˜¾ç¤ºæˆåŠŸå¼¹çª—
            setTimeout(() => {
                document.getElementById('stoneCount').textContent = stonesUsed;
                document.getElementById('successModal').classList.remove('hidden');
            }, 1500);
        }

        // æ’’èŠ±ç‰¹æ•ˆ
        function showConfetti() {
            const effect = document.getElementById('successEffect');
            const emojis = ['ğŸ‰', 'ğŸŠ', 'âœ¨', 'ğŸ’§', 'ğŸ¦', 'â­'];
            
            for (let i = 0; i < 20; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.innerHTML = emojis[Math.floor(Math.random() * emojis.length)];
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                effect.appendChild(confetti);
            }

            setTimeout(() => {
                effect.innerHTML = '';
            }, 3500);
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            document.getElementById('tutorial').classList.add('hidden');
            initAudio();
        }

        // é‡æ–°å¼€å§‹
        function restartGame() {
            stonesUsed = 0;
            waterLevel = 20;
            gameWon = false;

            document.getElementById('successModal').classList.add('hidden');
            document.getElementById('water').style.height = '20%';
            document.getElementById('bottleStones').innerHTML = '';
            document.getElementById('crow').classList.remove('drinking');

            initStones();
            updateDisplay();
        }

        // åˆå§‹åŒ–
        initStones();
        updateDisplay();
    </script>
</body>
</html>
