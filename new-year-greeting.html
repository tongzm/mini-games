<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ§§ æ–°æ˜¥ç¥ç¦å¤§å¸ˆ - ä¸“å±è¿åŠ¿ + çƒŸèŠ±ç‰¹æ•ˆ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-user-select: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #D9342B 0%, #8B0000 50%, #D9342B 100%);
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            padding-bottom: 30px;
        }

        /* çƒŸèŠ±ç”»å¸ƒ */
        #fireworks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        /* é‡‘è‰²ç²’å­èƒŒæ™¯ */
        .particles {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }

        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #FFD700;
            border-radius: 50%;
            animation: float 8s infinite ease-in-out;
            opacity: 0.6;
        }

        @keyframes float {
            0%, 100% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
        }

        /* æ ‡é¢˜ */
        .header {
            text-align: center;
            padding: 20px;
            z-index: 10;
            margin-top: 10px;
        }

        h1 {
            font-size: 36px;
            color: #FFD700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5), 2px 2px 4px rgba(0,0,0,0.3);
            letter-spacing: 3px;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 20px rgba(255, 215, 0, 0.5), 2px 2px 4px rgba(0,0,0,0.3); }
            to { text-shadow: 0 0 40px rgba(255, 215, 0, 0.8), 0 0 60px rgba(255, 215, 0, 0.4), 2px 2px 4px rgba(0,0,0,0.3); }
        }

        .subtitle {
            color: rgba(255,255,255,0.8);
            font-size: 16px;
            margin-top: 8px;
        }

        /* åå­—è¾“å…¥åŒº */
        .name-section {
            width: 90%;
            max-width: 500px;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin: 15px 0;
            z-index: 10;
            border: 2px solid rgba(255,215,0,0.3);
        }

        .name-section label {
            color: #FFD700;
            font-size: 18px;
            font-weight: bold;
        }

        .name-input-row {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .name-input-row input {
            flex: 1;
            padding: 15px;
            border: 2px solid #FFD700;
            border-radius: 30px;
            font-size: 18px;
            background: rgba(255,255,255,0.9);
            outline: none;
        }

        .name-input-row button {
            padding: 15px 25px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: none;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            color: #8B0000;
            cursor: pointer;
            white-space: nowrap;
        }

        /* ç¥ç¦è¯­å¡ç‰‡ */
        .card-container {
            width: 90%;
            max-width: 500px;
            min-height: 200px;
            background: linear-gradient(145deg, #FFF8DC, #FFEFD5);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3), inset 0 0 30px rgba(255,215,0,0.1);
            border: 4px solid #FFD700;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 10;
            margin: 10px 0;
            overflow: hidden;
        }

        .card-container::before {
            content: "ğŸ§§";
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 50px;
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3));
        }

        #greeting-text {
            font-size: 28px;
            line-height: 1.8;
            color: #B22222;
            text-align: center;
            font-weight: bold;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        /* è¿åŠ¿åŒº */
        .fortune-section {
            width: 90%;
            max-width: 500px;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin: 15px 0;
            z-index: 10;
            border: 2px solid rgba(255,215,0,0.5);
        }

        .fortune-title {
            color: #FFD700;
            font-size: 22px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
        }

        .fortune-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .fortune-item {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255,215,0,0.3);
            transition: transform 0.2s;
        }

        .fortune-item:active {
            transform: scale(0.95);
        }

        .fortune-label {
            color: rgba(255,255,255,0.7);
            font-size: 14px;
            margin-bottom: 5px;
        }

        .fortune-value {
            color: #FFD700;
            font-size: 20px;
            font-weight: bold;
        }

        .fortune-stars {
            color: #FFD700;
            font-size: 16px;
            margin-top: 5px;
        }

        /* æŒ‰é’®åŒºåŸŸ */
        .btn-group {
            width: 90%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 10;
            margin: 15px 0;
        }

        .btn-row {
            display: flex;
            gap: 15px;
        }

        .btn {
            flex: 1;
            border: none;
            border-radius: 50px;
            padding: 18px 0;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            text-align: center;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-primary {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #8B0000;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            border: 3px solid #FFD700;
            color: #FFD700;
        }

        .btn-shake {
            background: linear-gradient(135deg, #FF6B6B 0%, #EE5A5A 100%);
            color: white;
            animation: shake-hint 3s ease-in-out infinite;
        }

        @keyframes shake-hint {
            0%, 100% { transform: rotate(0deg); }
            2% { transform: rotate(-3deg); }
            4% { transform: rotate(3deg); }
            6% { transform: rotate(-3deg); }
            8% { transform: rotate(3deg); }
            10% { transform: rotate(0deg); }
        }

        /* Toast */
        #toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 30px 40px;
            border-radius: 20px;
            font-size: 22px;
            z-index: 2000;
            text-align: center;
            display: none;
            box-shadow: 0 0 30px rgba(255,215,0,0.5);
            border: 2px solid #FFD700;
        }

        /* æ‘‡ä¸€æ‘‡æç¤º */
        .shake-indicator {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: #FFD700;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 100;
            display: none;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }

        /* éŸ³ä¹æ§åˆ¶ */
        .music-control {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 200;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            cursor: pointer;
            font-size: 24px;
        }

        .music-control.rotating {
            animation: rotate 3s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .footer {
            color: rgba(255,255,255,0.4);
            font-size: 12px;
            margin-top: 20px;
            z-index: 10;
        }

        /* åŠ¨ç”»ç±» */
        .pop-in {
            animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .shake-animation {
            animation: shakeIt 0.5s ease-in-out;
        }

        @keyframes shakeIt {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-20px) rotate(-5deg); }
            40% { transform: translateX(20px) rotate(5deg); }
            60% { transform: translateX(-15px) rotate(-3deg); }
            80% { transform: translateX(15px) rotate(3deg); }
        }
    </style>
</head>
<body>

    <!-- çƒŸèŠ±ç”»å¸ƒ -->
    <canvas id="fireworks"></canvas>

    <!-- é‡‘è‰²ç²’å­èƒŒæ™¯ -->
    <div class="particles" id="particles"></div>

    <!-- éŸ³ä¹æ§åˆ¶ -->
    <div class="music-control" id="musicBtn" onclick="toggleMusic()">
        <span id="musicIcon">ğŸµ</span>
    </div>

    <!-- èƒŒæ™¯éŸ³ä¹ -->
    <audio id="bgMusic" loop preload="auto">
        <source src="https://cdn.pixabay.com/audio/2022/01/18/audio_d0a13f69d2.mp3" type="audio/mpeg">
    </audio>

    <header class="header">
        <h1>ğŸ† æ–°æ˜¥ç¥ç¦å¤§å¸ˆ</h1>
        <p class="subtitle">ä¸“å±ç¥ç¦ Â· è¿åŠ¿æµ‹ç®— Â· æ‘‡ä¸€æ‘‡æ¢ç¦</p>
    </header>

    <!-- åå­—è¾“å…¥ -->
    <div class="name-section">
        <label>ğŸ‘¤ è¾“å…¥åå­—ï¼Œç”Ÿæˆä¸“å±ç¥ç¦ï¼š</label>
        <div class="name-input-row">
            <input type="text" id="nameInput" placeholder="ä¾‹å¦‚ï¼šå¼ é˜¿å§¨" maxlength="10">
            <button onclick="generatePersonalized()">ç”Ÿæˆ âœ¨</button>
        </div>
    </div>

    <!-- ç¥ç¦è¯­å¡ç‰‡ -->
    <main class="card-container" id="card">
        <div id="greeting-text">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œå¼€å¯æ–°å¹´ç¥ç¦ ğŸ‰</div>
    </main>

    <!-- è¿åŠ¿æµ‹è¯• -->
    <div class="fortune-section" id="fortuneSection" style="display:none;">
        <div class="fortune-title">ğŸ”® 2025 è›‡å¹´è¿åŠ¿</div>
        <div class="fortune-grid">
            <div class="fortune-item">
                <div class="fortune-label">ğŸ’° è´¢è¿</div>
                <div class="fortune-value" id="fortune-money">-</div>
                <div class="fortune-stars" id="fortune-money-stars"></div>
            </div>
            <div class="fortune-item">
                <div class="fortune-label">â¤ï¸ æ¡ƒèŠ±</div>
                <div class="fortune-value" id="fortune-love">-</div>
                <div class="fortune-stars" id="fortune-love-stars"></div>
            </div>
            <div class="fortune-item">
                <div class="fortune-label">ğŸ’ª å¥åº·</div>
                <div class="fortune-value" id="fortune-health">-</div>
                <div class="fortune-stars" id="fortune-health-stars"></div>
            </div>
            <div class="fortune-item">
                <div class="fortune-label">ğŸ¯ äº‹ä¸š</div>
                <div class="fortune-value" id="fortune-career">-</div>
                <div class="fortune-stars" id="fortune-career-stars"></div>
            </div>
        </div>
    </div>

    <!-- æŒ‰é’®ç»„ -->
    <div class="btn-group">
        <div class="btn-row">
            <button class="btn btn-primary" onclick="newGreeting()">ğŸ”„ æ¢ä¸€å¥</button>
            <button class="btn btn-secondary" onclick="copyGreeting()">ğŸ“‹ å¤åˆ¶</button>
        </div>
        <button class="btn btn-shake" onclick="testFortune()">ğŸ”® æµ‹æµ‹æ–°å¹´è¿åŠ¿</button>
    </div>

    <!-- æ‘‡ä¸€æ‘‡æç¤º -->
    <div class="shake-indicator" id="shakeIndicator">ğŸ“± æ‘‡ä¸€æ‘‡æ‰‹æœºæ¢ç¥ç¦ï¼</div>

    <div id="toast"></div>

    <div class="footer">ç”±å‡Œå‡Œä¸ºæ‚¨åˆ¶ä½œ â¤ï¸ è›‡å¹´å¤§å‰</div>

    <script>
        // ========== ç¥ç¦è¯­åº“ ==========
        const greetings = [
            "æ–°æ˜¥å¿«ä¹ï¼ç¥æ‚¨èº«ä½“å¥åº·ï¼Œä¸‡äº‹å¦‚æ„ï¼Œç¬‘å£å¸¸å¼€ï¼Œé˜–å®¶å¹¸ç¦ï¼",
            "è¿‡å¹´å¥½ï¼æ„¿æ‚¨æ–°çš„ä¸€å¹´ï¼šåƒå¾—å¥½ï¼Œç¡å¾—é¦™ï¼Œæ²¡çƒ¦æ¼ï¼Œç¦æ°”æ—ºï¼",
            "é‡‘è›‡èˆæ˜¥é£ï¼Œç»™æ‚¨æ‹œå¹´å•¦ï¼ç¥æ‚¨å’Œå®¶äººå¹³å¹³å®‰å®‰ï¼Œé¡ºé¡ºåˆ©åˆ©ï¼",
            "ç¥æ‚¨æ–°çš„ä¸€å¹´ï¼šèº«ä½“ç¡¬æœ—æœ—ï¼Œå¿ƒæƒ…å–œæ´‹æ´‹ï¼Œæ—¥å­çº¢ç«ç«ï¼",
            "æ˜¥èŠ‚åˆ°ï¼Œç¦æ°”åˆ°ï¼ç¥æ‚¨ç¦å¦‚ä¸œæµ·é•¿æµæ°´ï¼Œå¯¿æ¯”å—å±±ä¸è€æ¾ï¼",
            "ç»™æ‚¨æ‹œä¸ªæ—©å¹´ï¼æ„¿æ–°çš„ä¸€å¹´é‡Œï¼Œå¥½äº‹æ¥äºŒè¿ä¸‰ï¼Œå¿ƒæƒ…å››å­£å¦‚æ˜¥ï¼",
            "æ–°æ˜¥å¤§å‰ï¼ç¥æ‚¨ï¼šå¿ƒæƒ³äº‹æˆï¼Œå²å²å¹³å®‰ï¼Œå¹´å¹´æœ‰ä½™ï¼",
            "ç¥æ‚¨æ–°å¹´å¿«ä¹ï¼æ„¿æ‚¨æ¯å¤©éƒ½ç²¾ç¥ç™¾å€ï¼Œå¼€å¼€å¿ƒå¿ƒï¼Œå¥å¥åº·åº·ï¼",
            "è¿‡å¹´å•¦ï¼ç¥æ‚¨è€å½“ç›Šå£®ï¼Œç²¾ç¥çŸé“„ï¼Œå„¿å­™æ»¡å ‚ï¼Œä¹äº«å¤©ä¼¦ï¼",
            "æ–°çš„ä¸€å¹´ï¼Œç¥æ‚¨è…¿è„šçµä¾¿ï¼Œç‰™å£å¥½ï¼Œåƒå˜›å˜›é¦™ï¼Œèº«ä½“å€å„¿æ£’ï¼",
            "ç»™æ‚¨é€ç¦å•¦ï¼æ„¿æ‚¨æ–°çš„ä¸€å¹´ï¼Œçƒ¦æ¼å…¨æ¶ˆï¼Œå¿«ä¹åŠ å€ï¼Œå¹¸ç¦å®‰åº·ï¼",
            "æ˜¥èŠ‚å¿«ä¹ï¼ç¥æ‚¨å‰ç¥¥å¦‚æ„ï¼ŒèŠ±å¼€å¯Œè´µï¼Œç”Ÿæ´»ç¾æ»¡ï¼Œå¥½è¿è¿è¿ï¼",
            "ç¥æ‚¨ï¼šæ–°æ˜¥å¿«ä¹ï¼Œå¤§å‰å¤§åˆ©ï¼æ„¿æ‚¨å¤©å¤©å¼€å¿ƒï¼Œäº‹äº‹é¡ºå¿ƒï¼",
            "æ‹œå¹´å•¦ï¼ç¥æ‚¨å’Œè€ä¼´å„¿ï¼šèº«ä½“å¥åº·ï¼Œæ©æ©çˆ±çˆ±ï¼Œç™½å¤´å•è€ï¼",
            "ç¥æ‚¨æ–°å¹´æ–°æ°”è±¡ï¼Œçº¢çº¢ç«ç«è¿‡å¤§å¹´ï¼Œå¹³å¹³å®‰å®‰ä¸€è¾ˆå­ï¼",
            "æ„¿æ‚¨æ–°çš„ä¸€å¹´ï¼šå¤šå–œä¹ï¼Œé•¿å®‰å®ï¼Œå²æ— å¿§ï¼Œä¹…å®‰åº·ï¼",
            "æ–°æ˜¥ä½³èŠ‚åˆ°ï¼Œç¥æ‚¨ï¼šç¦æ°”æ»¡æ»¡ï¼Œè´¢æ°”æ»šæ»šï¼Œå–œæ°”æ´‹æ´‹ï¼",
            "ç»™æ‚¨æ‹œå¹´äº†ï¼ç¥æ‚¨è¶Šæ´»è¶Šå¹´è½»ï¼Œè¶Šæ´»è¶Šå¼€å¿ƒï¼Œè¶Šæ´»è¶Šç²¾å½©ï¼",
            "ç¥æ‚¨æ–°çš„ä¸€å¹´ï¼šæ— ç—…æ— ç¾ï¼Œæ— å¿§æ— è™‘ï¼Œå¼€å¼€å¿ƒå¿ƒè¿‡å¥½æ¯ä¸€å¤©ï¼",
            "æ–°å¹´å¥½ï¼ç¥æ‚¨é˜–å®¶å›¢åœ†ï¼Œå¹¸ç¦ç¾æ»¡ï¼Œé¾™é©¬ç²¾ç¥ï¼Œä¸‡äº‹é¡ºé‚ï¼"
        ];

        const personalizedTemplates = [
            "{name}ï¼Œæ–°æ˜¥å¿«ä¹ï¼ğŸ§§ ç¥æ‚¨è›‡å¹´å¤§å‰ï¼Œç¦æ°”æ»¡æ»¡ï¼Œä¸‡äº‹å¦‚æ„ï¼",
            "äº²çˆ±çš„{name}ï¼Œç»™æ‚¨æ‹œå¹´å•¦ï¼ğŸ† æ„¿æ‚¨æ–°çš„ä¸€å¹´å¥åº·å¹³å®‰ï¼Œç¬‘å£å¸¸å¼€ï¼",
            "{name}å‰ç¥¥ï¼ğŸ è›‡å¹´åˆ°ï¼Œç¦è¿åˆ°ï¼Œç¥æ‚¨è´¢æºå¹¿è¿›ï¼Œå¥½è¿è¿è¿ï¼",
            "æ•¬çˆ±çš„{name}ï¼Œæ–°å¹´å¥½ï¼âœ¨ æ„¿æ‚¨èº«ä½“å¥åº·ï¼Œå¿ƒæƒ³äº‹æˆï¼Œé˜–å®¶å¹¸ç¦ï¼",
            "{name}ï¼Œè›‡å¹´å¤§å‰ï¼ğŸŠ ç¥æ‚¨ç¦å¯¿å®‰åº·ï¼Œå„¿å­™æ»¡å ‚ï¼Œå¹¸ç¦ç¾æ»¡ï¼"
        ];

        const fortuneTexts = {
            money: ["å°æœ‰æ”¶è·", "ç¨³ä¸­æœ‰è¿›", "è´¢è¿äº¨é€š", "é‡‘ç‰æ»¡å ‚", "è´¢æºæ»šæ»š"],
            love: ["å¹³å¹³æ·¡æ·¡", "æ¸©é¦¨ç”œèœœ", "æ¡ƒèŠ±æœµæœµ", "å–œäº‹è¿è¿", "å¤©ä½œä¹‹åˆ"],
            health: ["æ³¨æ„ä¼‘æ¯", "èº«ä½“å¥åº·", "ç²¾åŠ›å……æ²›", "é¾™é©¬ç²¾ç¥", "å¥æ­¥å¦‚é£"],
            career: ["ç¨³æ‰ç¨³æ‰“", "æ­¥æ­¥é«˜å‡", "è’¸è’¸æ—¥ä¸Š", "å¤§å±•å®å›¾", "äº‹ä¸šæœ‰æˆ"]
        };

        let lastIndex = -1;
        let currentName = "";

        // ========== çƒŸèŠ±ç‰¹æ•ˆ ==========
        const canvas = document.getElementById('fireworks');
        const ctx = canvas.getContext('2d');
        let fireworks = [];
        let particles = [];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        class Firework {
            constructor(x, y, targetY) {
                this.x = x;
                this.y = y;
                this.targetY = targetY;
                this.speed = 8 + Math.random() * 4;
                this.angle = -Math.PI / 2 + (Math.random() - 0.5) * 0.3;
                this.gravity = 0.05;
                this.opacity = 1;
                this.trail = [];
                this.hue = Math.random() * 60 + 10; // é‡‘çº¢è‰²ç³»
            }

            update() {
                this.trail.push({ x: this.x, y: this.y, opacity: this.opacity });
                if (this.trail.length > 10) this.trail.shift();

                this.x += Math.cos(this.angle) * this.speed;
                this.y += Math.sin(this.angle) * this.speed + this.gravity;

                if (this.y <= this.targetY) {
                    this.explode();
                    return false;
                }
                return true;
            }

            explode() {
                const particleCount = 80 + Math.floor(Math.random() * 40);
                for (let i = 0; i < particleCount; i++) {
                    const angle = (Math.PI * 2 / particleCount) * i;
                    const speed = 2 + Math.random() * 4;
                    particles.push(new Particle(this.x, this.y, angle, speed, this.hue));
                }
            }

            draw() {
                // å°¾è¿¹
                this.trail.forEach((point, i) => {
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, 2, 0, Math.PI * 2);
                    ctx.fillStyle = `hsla(${this.hue}, 100%, 50%, ${i / this.trail.length * 0.5})`;
                    ctx.fill();
                });

                // ä¸»ä½“
                ctx.beginPath();
                ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
                ctx.fillStyle = `hsl(${this.hue}, 100%, 70%)`;
                ctx.fill();
            }
        }

        class Particle {
            constructor(x, y, angle, speed, hue) {
                this.x = x;
                this.y = y;
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;
                this.gravity = 0.08;
                this.friction = 0.98;
                this.opacity = 1;
                this.hue = hue + Math.random() * 30 - 15;
                this.size = 2 + Math.random() * 2;
            }

            update() {
                this.vx *= this.friction;
                this.vy *= this.friction;
                this.vy += this.gravity;
                this.x += this.vx;
                this.y += this.vy;
                this.opacity -= 0.015;
                this.size *= 0.98;
                return this.opacity > 0;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = `hsla(${this.hue}, 100%, 60%, ${this.opacity})`;
                ctx.fill();
            }
        }

        function launchFirework() {
            const x = Math.random() * canvas.width;
            const targetY = 100 + Math.random() * (canvas.height * 0.4);
            fireworks.push(new Firework(x, canvas.height, targetY));
        }

        function animateFireworks() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            fireworks = fireworks.filter(f => {
                f.draw();
                return f.update();
            });

            particles = particles.filter(p => {
                p.draw();
                return p.update();
            });

            requestAnimationFrame(animateFireworks);
        }
        animateFireworks();

        // æ”¾ä¸€è½®çƒŸèŠ±
        function fireFireworks(count = 5) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => launchFirework(), i * 200);
            }
        }

        // ========== é‡‘è‰²ç²’å­èƒŒæ™¯ ==========
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 8 + 's';
                particle.style.animationDuration = (6 + Math.random() * 4) + 's';
                container.appendChild(particle);
            }
        }
        createParticles();

        // ========== éŸ³ä¹æ§åˆ¶ ==========
        const bgMusic = document.getElementById('bgMusic');
        const musicBtn = document.getElementById('musicBtn');
        const musicIcon = document.getElementById('musicIcon');
        let isPlaying = false;
        let musicInit = false;

        bgMusic.volume = 0.4;

        function initMusic() {
            if (musicInit) return;
            bgMusic.play().then(() => {
                musicBtn.classList.add('rotating');
                musicIcon.innerText = 'â¸ï¸';
                isPlaying = true;
                musicInit = true;
            }).catch(() => {});
        }

        function toggleMusic() {
            if (!musicInit) {
                initMusic();
                return;
            }
            if (isPlaying) {
                bgMusic.pause();
                musicBtn.classList.remove('rotating');
                musicIcon.innerText = 'ğŸµ';
                isPlaying = false;
            } else {
                bgMusic.play();
                musicBtn.classList.add('rotating');
                musicIcon.innerText = 'â¸ï¸';
                isPlaying = true;
            }
        }

        // ========== æ ¸å¿ƒåŠŸèƒ½ ==========

        // æ¢ç¥ç¦è¯­
        function newGreeting() {
            const textEl = document.getElementById('greeting-text');
            const cardEl = document.getElementById('card');

            let index;
            do {
                index = Math.floor(Math.random() * greetings.length);
            } while (index === lastIndex && greetings.length > 1);
            lastIndex = index;

            cardEl.classList.remove('pop-in');
            textEl.style.opacity = 0;

            setTimeout(() => {
                textEl.innerText = greetings[index];
                textEl.style.opacity = 1;
                cardEl.classList.add('pop-in');
                fireFireworks(3);
            }, 200);

            if (!musicInit) initMusic();
        }

        // ä¸“å±ç¥ç¦
        function generatePersonalized() {
            const nameInput = document.getElementById('nameInput');
            const name = nameInput.value.trim();

            if (!name) {
                showToast('è¯·è¾“å…¥åå­—å“¦ï½');
                return;
            }

            currentName = name;
            const template = personalizedTemplates[Math.floor(Math.random() * personalizedTemplates.length)];
            const greeting = template.replace('{name}', name);

            const textEl = document.getElementById('greeting-text');
            const cardEl = document.getElementById('card');

            cardEl.classList.remove('pop-in');
            textEl.style.opacity = 0;

            setTimeout(() => {
                textEl.innerText = greeting;
                textEl.style.opacity = 1;
                cardEl.classList.add('pop-in');
                fireFireworks(5);
            }, 200);

            if (!musicInit) initMusic();
        }

        // è¿åŠ¿æµ‹è¯•
        function testFortune() {
            const section = document.getElementById('fortuneSection');
            section.style.display = 'block';
            section.classList.remove('pop-in');
            void section.offsetWidth;
            section.classList.add('pop-in');

            // éšæœºç”Ÿæˆè¿åŠ¿
            ['money', 'love', 'health', 'career'].forEach(type => {
                const level = Math.floor(Math.random() * 5);
                const texts = fortuneTexts[type];
                document.getElementById('fortune-' + type).innerText = texts[level];
                document.getElementById('fortune-' + type + '-stars').innerText = 'â­'.repeat(level + 1);
            });

            fireFireworks(4);
            showToast('ğŸ”® è¿åŠ¿å·²æ­æ™“ï¼');

            if (!musicInit) initMusic();
        }

        // å¤åˆ¶ç¥ç¦è¯­
        function copyGreeting() {
            const text = document.getElementById('greeting-text').innerText;
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => showToast('âœ… å·²å¤åˆ¶ï¼å»å¾®ä¿¡ç²˜è´´å§'));
            } else {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-9999px';
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast('âœ… å·²å¤åˆ¶ï¼');
            }
        }

        // Toast æç¤º
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.style.display = 'block';
            setTimeout(() => { toast.style.display = 'none'; }, 2000);
        }

        // ========== æ‘‡ä¸€æ‘‡ ==========
        let shakeThreshold = 15;
        let lastX = null, lastY = null, lastZ = null;

        if (window.DeviceMotionEvent) {
            document.getElementById('shakeIndicator').style.display = 'block';

            window.addEventListener('devicemotion', (e) => {
                const acc = e.accelerationIncludingGravity;
                if (!acc) return;

                if (lastX !== null) {
                    const deltaX = Math.abs(acc.x - lastX);
                    const deltaY = Math.abs(acc.y - lastY);
                    const deltaZ = Math.abs(acc.z - lastZ);

                    if (deltaX + deltaY + deltaZ > shakeThreshold) {
                        handleShake();
                    }
                }

                lastX = acc.x;
                lastY = acc.y;
                lastZ = acc.z;
            });
        }

        let shakeTimeout = false;
        function handleShake() {
            if (shakeTimeout) return;
            shakeTimeout = true;

            const card = document.getElementById('card');
            card.classList.add('shake-animation');
            setTimeout(() => card.classList.remove('shake-animation'), 500);

            newGreeting();

            // éœ‡åŠ¨åé¦ˆ
            if (navigator.vibrate) {
                navigator.vibrate(200);
            }

            setTimeout(() => { shakeTimeout = false; }, 1000);
        }

        // ========== åˆå§‹åŒ– ==========
        document.addEventListener('DOMContentLoaded', () => {
            // é¦–æ¬¡è¿›å…¥æ”¾çƒŸèŠ±
            setTimeout(() => fireFireworks(3), 500);

            // ç‚¹å‡»ä»»æ„åœ°æ–¹å°è¯•æ’­æ”¾éŸ³ä¹
            document.body.addEventListener('click', () => {
                if (!musicInit) initMusic();
            }, { once: true });
        });
    </script>
</body>
</html>
