<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ğŸ”¢ 24ç‚¹æŒ‘æˆ˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #1a237e 0%, #283593 50%, #3949ab 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            color: white;
        }

        h1 {
            font-size: 36px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .game-info {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            font-size: 22px;
        }

        .info-box {
            background: rgba(255,255,255,0.15);
            padding: 10px 25px;
            border-radius: 25px;
        }

        .cards-area {
            display: flex;
            gap: 12px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .card {
            width: 70px;
            height: 100px;
            background: linear-gradient(145deg, #fff, #f0f0f0);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: bold;
            color: #c62828;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .card.black {
            color: #212121;
        }

        .question-text {
            font-size: 26px;
            margin: 15px 0;
            text-align: center;
        }

        .target {
            font-size: 60px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin: 10px 0;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 380px;
            margin: 20px 0;
        }

        .option-btn {
            background: linear-gradient(145deg, #fff, #f5f5f5);
            border: none;
            border-radius: 15px;
            padding: 18px 25px;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.2s;
            text-align: center;
        }

        .option-btn:active {
            transform: scale(0.98);
        }

        .option-btn.correct {
            background: linear-gradient(145deg, #4caf50, #388e3c) !important;
            color: white !important;
        }

        .option-btn.wrong {
            background: linear-gradient(145deg, #9e9e9e, #757575) !important;
            color: white !important;
        }

        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 15px 35px;
            font-size: 24px;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-next {
            background: linear-gradient(145deg, #7c4dff, #651fff);
            color: white;
            box-shadow: 0 4px 15px rgba(124,77,255,0.4);
        }

        .btn:active {
            transform: scale(0.95);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .modal.hidden {
            display: none !important;
        }

        .modal-content {
            background: linear-gradient(145deg, #fff8e1, #ffecb3);
            padding: 30px;
            border-radius: 25px;
            text-align: center;
            max-width: 90%;
            width: 380px;
            color: #333;
        }

        .modal h2 {
            color: #e65100;
            font-size: 30px;
            margin-bottom: 15px;
        }

        .modal p {
            font-size: 22px;
            margin-bottom: 10px;
            color: #5d4037;
        }

        .modal .emoji-big {
            font-size: 70px;
            margin: 15px 0;
        }

        .btn-primary {
            background: linear-gradient(145deg, #4caf50, #388e3c);
            color: white;
            padding: 15px 45px;
            font-size: 26px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 15px;
            box-shadow: 0 4px 15px rgba(76,175,80,0.4);
        }

        .result-text {
            font-size: 20px;
            color: rgba(255,255,255,0.8);
            margin-top: 15px;
            min-height: 30px;
        }

        .score-up {
            color: #4caf50;
            font-weight: bold;
        }

        .success-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
        }

        .confetti {
            position: absolute;
            font-size: 30px;
            animation: fall 2s ease-out forwards;
        }

        @keyframes fall {
            0% { opacity: 1; transform: translateY(-20px) rotate(0deg); }
            100% { opacity: 0; transform: translateY(100vh) rotate(720deg); }
        }
    </style>
</head>
<body>
    <div class="modal" id="tutorial">
        <div class="modal-content">
            <h2>ğŸ”¢ 24ç‚¹æŒ‘æˆ˜</h2>
            <div class="emoji-big">ğŸƒğŸ§ </div>
            <p>çœ‹4å¼ æ‰‘å…‹ç‰Œçš„æ•°å­—</p>
            <p>ğŸ‘‡ é€‰å‡ºèƒ½ç®—å‡º <b style="color:#c62828;">24</b> çš„ç®—å¼</p>
            <p style="font-size:18px;color:#888;">ç®€å•ç‚¹å‡»ï¼Œè½»æ¾åŠ¨è„‘ï¼</p>
            <button class="btn-primary" onclick="startGame()">å¼€å§‹æŒ‘æˆ˜ï¼</button>
        </div>
    </div>

    <h1>ğŸ”¢ 24ç‚¹æŒ‘æˆ˜</h1>

    <div class="game-info">
        <div class="info-box">ç¬¬ <span id="level">1</span> é¢˜</div>
        <div class="info-box">å¾—åˆ† <span id="score">0</span></div>
    </div>

    <div class="cards-area" id="cardsArea"></div>

    <div class="question-text">å“ªä¸ªç®—å¼ç­‰äº</div>
    <div class="target">24</div>

    <div class="options" id="optionsArea"></div>

    <div class="result-text" id="resultText"></div>

    <div class="buttons">
        <button class="btn btn-next" id="nextBtn" onclick="nextQuestion()" style="display:none;">ä¸‹ä¸€é¢˜ â–¶</button>
    </div>

    <div class="success-overlay" id="successOverlay"></div>

    <script>
        // é¢˜åº“
        const PUZZLES = [
            { nums: [1, 2, 3, 4], correct: "(1+2+3)Ã—4=24", wrongs: ["1+2+3+4=10", "1Ã—2Ã—3+4=10", "4Ã—3+2+1=15"] },
            { nums: [1, 2, 6, 8], correct: "(6-1-2)Ã—8=24", wrongs: ["6+8+1+2=17", "8Ã—2+6+1=23", "6Ã—2+8+1=21"] },
            { nums: [2, 3, 4, 5], correct: "(5+3-2)Ã—4=24", wrongs: ["5+4+3+2=14", "5Ã—4+3-2=21", "4Ã—3+5+2=19"] },
            { nums: [1, 3, 6, 7], correct: "(7+1)Ã—(6-3)=24", wrongs: ["7+6+3+1=17", "7Ã—3+6-1=26", "6Ã—3+7+1=26"] },
            { nums: [1, 2, 5, 8], correct: "(5-1)Ã—(8-2)=24", wrongs: ["5+8+2+1=16", "8Ã—2+5+1=22", "5Ã—2+8+1=19"] },
            { nums: [2, 4, 4, 6], correct: "4Ã—4+6+2=24", wrongs: ["4+4+6+2=16", "6Ã—4-4+2=22", "4Ã—6+4-2=26"] },
            { nums: [3, 4, 5, 6], correct: "(5-4+3)Ã—6=24", wrongs: ["5+4+6+3=18", "6Ã—5-4-3=23", "5Ã—4+6-3=23"] },
            { nums: [1, 2, 3, 8], correct: "(8-2)Ã—(3+1)=24", wrongs: ["8+3+2+1=14", "8Ã—3-2+1=23", "3Ã—8+2-1=25"] },
            { nums: [1, 3, 3, 5], correct: "(3+3)Ã—(5-1)=24", wrongs: ["5+3+3+1=12", "5Ã—3+3+1=19", "3Ã—3+5+1=15"] },
            { nums: [1, 2, 3, 5], correct: "(5+3)Ã—(2+1)=24", wrongs: ["5+3+2+1=11", "5Ã—3+2+1=18", "5Ã—2+3+1=14"] },
            { nums: [1, 4, 6, 7], correct: "6Ã—(7-4+1)=24", wrongs: ["7+6+4+1=18", "7Ã—4-6+1=23", "6Ã—4-7+1=18"] },
            { nums: [1, 3, 4, 8], correct: "(8-4)Ã—(3+1)=24", wrongs: ["8+4+3+1=16", "8Ã—3-4+1=21", "4Ã—3+8+1=21"] },
            { nums: [1, 2, 2, 6], correct: "(6+2)Ã—(2+1)=24", wrongs: ["6+2+2+1=11", "6Ã—2+2+1=15", "6Ã—2Ã—2-1=23"] },
            { nums: [2, 3, 3, 8], correct: "8Ã—(3+3)Ã·2=24", wrongs: ["8+3+3+2=16", "8Ã—3-3+2=23", "3Ã—3+8+2=19"] },
            { nums: [1, 1, 3, 8], correct: "8Ã—3Ã—1Ã—1=24", wrongs: ["8+3+1+1=13", "8Ã—3+1+1=26", "8Ã—3-1-1=22"] },
            { nums: [2, 2, 8, 9], correct: "9Ã—2+8-2=24", wrongs: ["9+8+2+2=21", "9Ã—2+8+2=28", "8Ã—2+9-2=23"] }
        ];

        let level = 0;
        let score = 0;
        let currentPuzzle = null;
        let answered = false;
        let usedPuzzles = [];
        let audioCtx = null;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playSound(freqs) {
            if (!audioCtx) return;
            freqs.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime + i * 0.1);
                gain.gain.setValueAtTime(0.2, audioCtx.currentTime + i * 0.1);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + i * 0.1 + 0.15);
                osc.start(audioCtx.currentTime + i * 0.1);
                osc.stop(audioCtx.currentTime + i * 0.1 + 0.15);
            });
        }

        function loadQuestion() {
            answered = false;
            level++;
            document.getElementById('level').textContent = level;
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('resultText').textContent = '';

            let available = PUZZLES.filter((_, i) => !usedPuzzles.includes(i));
            if (available.length === 0) {
                usedPuzzles = [];
                available = PUZZLES;
            }
            const idx = PUZZLES.indexOf(available[Math.floor(Math.random() * available.length)]);
            usedPuzzles.push(idx);
            currentPuzzle = PUZZLES[idx];

            const cardsArea = document.getElementById('cardsArea');
            cardsArea.innerHTML = '';
            [...currentPuzzle.nums].sort(() => 0.5 - Math.random()).forEach(num => {
                const card = document.createElement('div');
                card.className = 'card' + (Math.random() > 0.5 ? ' black' : '');
                card.textContent = num;
                cardsArea.appendChild(card);
            });

            const options = [currentPuzzle.correct, ...currentPuzzle.wrongs].sort(() => 0.5 - Math.random());
            const optionsArea = document.getElementById('optionsArea');
            optionsArea.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt;
                btn.onclick = () => checkAnswer(btn, opt);
                optionsArea.appendChild(btn);
            });
        }

        function checkAnswer(btn, answer) {
            if (answered) return;
            answered = true;
            initAudio();

            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(b => b.style.pointerEvents = 'none');

            if (answer === currentPuzzle.correct) {
                btn.classList.add('correct');
                playSound([523, 659, 784]);
                score += 10;
                document.getElementById('score').textContent = score;
                document.getElementById('resultText').innerHTML = '<span class="score-up">+10åˆ† å¤ªæ£’äº†ï¼</span>';
                showConfetti();
            } else {
                btn.classList.add('wrong');
                playSound([200]);
                buttons.forEach(b => {
                    if (b.textContent === currentPuzzle.correct) b.classList.add('correct');
                });
                document.getElementById('resultText').textContent = 'æ­£ç¡®ç­”æ¡ˆå·²æ ‡ç»¿';
            }
            document.getElementById('nextBtn').style.display = 'inline-block';
        }

        function nextQuestion() {
            loadQuestion();
        }

        function showConfetti() {
            const overlay = document.getElementById('successOverlay');
            const emojis = ['ğŸ‰', 'ğŸŠ', 'âœ¨', 'ğŸŒŸ', 'ğŸ’¯'];
            for (let i = 0; i < 12; i++) {
                const conf = document.createElement('div');
                conf.className = 'confetti';
                conf.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                conf.style.left = Math.random() * 100 + '%';
                conf.style.animationDelay = Math.random() * 0.3 + 's';
                overlay.appendChild(conf);
            }
            setTimeout(() => overlay.innerHTML = '', 2500);
        }

        function startGame() {
            document.getElementById('tutorial').classList.add('hidden');
            initAudio();
            level = 0;
            score = 0;
            usedPuzzles = [];
            document.getElementById('score').textContent = score;
            loadQuestion();
        }
    </script>
</body>
</html>
